%%% from SBDARTA/V2.4/spectra.f

wehrli = load('wehrli85.txt');
wehrli(:,1) = wehrli(:,1)/1000;
wehrli(:,2) = wehrli(:,2)*1000;

x1 = 0.25;
x2 = 4.0;
dx = 0.005;
%% units are w/m2/micron
lsun = x1 : dx : x2;
sun = [...
      6.930e+01,8.600e+01,1.141e+02,1.600e+02,1.790e+02,1.770e+02,...
      2.104e+02,2.730e+02,3.638e+02,5.050e+02,5.580e+02,5.370e+02,...
      5.810e+02,6.580e+02,7.308e+02,8.180e+02,9.260e+02,8.981e+02,...
      9.433e+02,9.087e+02,9.635e+02,1.026e+03,9.351e+02,1.137e+03,...
      1.190e+03,1.029e+03,1.149e+03,9.181e+02,1.146e+03,9.245e+02,...
      1.614e+03,1.648e+03,1.706e+03,1.783e+03,1.717e+03,1.693e+03,...
      1.502e+03,1.760e+03,1.790e+03,1.929e+03,2.057e+03,2.021e+03,...
      2.040e+03,2.013e+03,1.986e+03,2.019e+03,2.057e+03,1.879e+03,...
      1.933e+03,1.974e+03,1.897e+03,1.936e+03,1.938e+03,1.825e+03,...
      1.803e+03,1.861e+03,1.911e+03,1.899e+03,1.853e+03,1.878e+03,...
      1.871e+03,1.874e+03,1.827e+03,1.847e+03,1.835e+03,1.864e+03,...
      1.838e+03,1.843e+03,1.763e+03,1.795e+03,1.760e+03,1.769e+03,...
      1.737e+03,1.689e+03,1.717e+03,1.675e+03,1.669e+03,1.658e+03,...
      1.637e+03,1.623e+03,1.589e+03,1.515e+03,1.543e+03,1.555e+03,...
      1.534e+03,1.517e+03,1.499e+03,1.469e+03,1.459e+03,1.438e+03,...
      1.408e+03,1.407e+03,1.389e+03,1.368e+03,1.336e+03,1.352e+03,...
      1.328e+03,1.314e+03,1.276e+03,1.286e+03,1.270e+03,1.257e+03,...
      1.242e+03,1.220e+03,1.204e+03,1.199e+03,1.190e+03,1.181e+03,...
      1.168e+03,1.144e+03,1.143e+03,1.123e+03,1.110e+03,1.112e+03,...
      1.078e+03,1.077e+03,1.070e+03,1.047e+03,1.044e+03,1.030e+03,...
      9.909e+02,9.429e+02,1.003e+03,9.550e+02,9.669e+02,9.997e+02,...
      9.841e+02,9.740e+02,9.636e+02,9.529e+02,9.430e+02,9.330e+02,...
      9.230e+02,9.134e+02,9.041e+02,8.940e+02,8.844e+02,8.751e+02,...
      8.654e+02,8.565e+02,8.475e+02,8.385e+02,8.295e+02,8.205e+02,...
      8.115e+02,8.025e+02,7.939e+02,7.857e+02,7.769e+02,7.690e+02,...
      7.606e+02,7.515e+02,7.425e+02,7.339e+02,7.256e+02,7.169e+02,...
      7.090e+02,7.006e+02,6.919e+02,6.840e+02,6.760e+02,6.676e+02,...
      6.589e+02,6.518e+02,6.464e+02,6.411e+02,6.350e+02,6.294e+02,...
      6.241e+02,6.180e+02,6.124e+02,6.075e+02,6.021e+02,5.964e+02,...
      5.915e+02,5.861e+02,5.804e+02,5.755e+02,5.705e+02,5.655e+02,...
      5.605e+02,5.505e+02,5.505e+02,5.455e+02,5.405e+02,5.355e+02,...
      5.309e+02,5.270e+02,5.226e+02,5.179e+02,5.130e+02,5.062e+02,...
      4.996e+02,4.931e+02,4.865e+02,4.800e+02,4.735e+02,4.669e+02,...
      4.604e+02,4.538e+02,4.473e+02,4.408e+02,4.342e+02,4.277e+02,...
      4.211e+02,4.146e+02,4.080e+02,4.015e+02,3.950e+02,3.884e+02,...
      3.967e+02,4.071e+02,4.035e+02,3.998e+02,3.962e+02,3.925e+02,...
      3.889e+02,3.852e+02,3.816e+02,3.780e+02,3.743e+02,3.707e+02,...
      3.670e+02,3.634e+02,3.597e+02,3.560e+02,3.524e+02,3.488e+02,...
      3.451e+02,3.415e+02,3.422e+02,3.437e+02,3.409e+02,3.381e+02,...
      3.353e+02,3.325e+02,3.297e+02,3.270e+02,3.242e+02,3.214e+02,...
      3.186e+02,3.158e+02,3.130e+02,3.102e+02,3.075e+02,3.047e+02,...
      3.019e+02,2.991e+02,2.963e+02,2.935e+02,2.933e+02,2.934e+02,...
      2.911e+02,2.888e+02,2.865e+02,2.843e+02,2.820e+02,2.797e+02,...
      2.774e+02,2.751e+02,2.728e+02,2.705e+02,2.682e+02,2.659e+02,...
      2.636e+02,2.613e+02,2.591e+02,2.568e+02,2.545e+02,2.522e+02,...
      2.501e+02,2.481e+02,2.459e+02,2.436e+02,2.414e+02,2.391e+02,...
      2.369e+02,2.346e+02,2.324e+02,2.301e+02,2.279e+02,2.256e+02,...
      2.234e+02,2.212e+02,2.189e+02,2.167e+02,2.144e+02,2.122e+02,...
      2.099e+02,2.077e+02,2.063e+02,2.050e+02,2.029e+02,2.009e+02,...
      1.988e+02,1.967e+02,1.946e+02,1.925e+02,1.905e+02,1.884e+02,...
      1.863e+02,1.842e+02,1.821e+02,1.801e+02,1.780e+02,1.759e+02,...
      1.738e+02,1.717e+02,1.697e+02,1.676e+02,1.676e+02,1.679e+02,...
      1.663e+02,1.646e+02,1.629e+02,1.613e+02,1.596e+02,1.579e+02,...
      1.562e+02,1.546e+02,1.529e+02,1.512e+02,1.496e+02,1.479e+02,...
      1.462e+02,1.446e+02,1.429e+02,1.412e+02,1.395e+02,1.379e+02,...
      1.381e+02,1.386e+02,1.373e+02,1.360e+02,1.347e+02,1.334e+02,...
      1.321e+02,1.308e+02,1.295e+02,1.282e+02,1.269e+02,1.256e+02,...
      1.243e+02,1.230e+02,1.217e+02,1.204e+02,1.191e+02,1.178e+02,...
      1.165e+02,1.152e+02,1.153e+02,1.156e+02,1.146e+02,1.136e+02,...
      1.125e+02,1.115e+02,1.105e+02,1.095e+02,1.084e+02,1.074e+02,...
      1.064e+02,1.054e+02,1.043e+02,1.033e+02,1.023e+02,1.013e+02,...
      1.003e+02,9.922e+01,9.820e+01,9.718e+01,9.707e+01,9.711e+01,...
      9.626e+01,9.542e+01,9.456e+01,9.372e+01,9.289e+01,9.203e+01,...
      9.119e+01,9.034e+01,8.949e+01,8.866e+01,8.781e+01,8.697e+01,...
      8.612e+01,8.526e+01,8.443e+01,8.359e+01,8.275e+01,8.189e+01,...
      8.189e+01,8.202e+01,8.135e+01,8.065e+01,7.999e+01,7.930e+01,...
      7.861e+01,7.794e+01,7.726e+01,7.657e+01,7.590e+01,7.522e+01,...
      7.454e+01,7.386e+01,7.318e+01,7.250e+01,7.182e+01,7.114e+01,...
      7.047e+01,6.979e+01,6.973e+01,6.980e+01,6.924e+01,6.868e+01,...
      6.814e+01,6.757e+01,6.702e+01,6.648e+01,6.590e+01,6.536e+01,...
      6.480e+01,6.425e+01,6.369e+01,6.314e+01,6.257e+01,6.203e+01,...
      6.147e+01,6.092e+01,6.036e+01,5.981e+01,5.980e+01,5.985e+01,...
      5.940e+01,5.895e+01,5.850e+01,5.806e+01,5.760e+01,5.715e+01,...
      5.670e+01,5.626e+01,5.579e+01,5.536e+01,5.490e+01,5.443e+01,...
      5.400e+01,5.355e+01,5.309e+01,5.265e+01,5.220e+01,5.175e+01,...
      5.168e+01,5.167e+01,5.130e+01,5.092e+01,5.055e+01,5.018e+01,...
      4.979e+01,4.943e+01,4.904e+01,4.867e+01,4.830e+01,4.793e+01,...
      4.754e+01,4.718e+01,4.679e+01,4.642e+01,4.606e+01,4.567e+01,...
      4.530e+01,4.493e+01,4.482e+01,4.479e+01,4.445e+01,4.414e+01,...
      4.383e+01,4.349e+01,4.318e+01,4.286e+01,4.255e+01,4.221e+01,...
      4.190e+01,4.158e+01,4.126e+01,4.094e+01,4.062e+01,4.031e+01,...
      3.997e+01,3.966e+01,3.934e+01,3.903e+01,3.896e+01,3.892e+01,...
      3.866e+01,3.838e+01,3.812e+01,3.786e+01,3.758e+01,3.730e+01,...
      3.705e+01,3.677e+01,3.650e+01,3.623e+01,3.596e+01,3.569e+01,...
      3.542e+01,3.515e+01,3.488e+01,3.461e+01,3.434e+01,3.407e+01,...
      3.403e+01,3.403e+01,3.379e+01,3.357e+01,3.335e+01,3.312e+01,...
      3.290e+01,3.267e+01,3.244e+01,3.223e+01,3.200e+01,3.177e+01,...
      3.155e+01,3.131e+01,3.110e+01,3.087e+01,3.066e+01,3.042e+01,...
      3.020e+01,2.997e+01,2.990e+01,2.987e+01,2.966e+01,2.946e+01,...
      2.927e+01,2.908e+01,2.888e+01,2.867e+01,2.849e+01,2.830e+01,...
      2.810e+01,2.791e+01,2.771e+01,2.752e+01,2.731e+01,2.712e+01,...
      2.693e+01,2.674e+01,2.654e+01,2.635e+01,2.631e+01,2.628e+01,...
      2.612e+01,2.595e+01,2.579e+01,2.564e+01,2.545e+01,2.530e+01,...
      2.512e+01,2.498e+01,2.480e+01,2.463e+01,2.447e+01,2.431e+01,...
      2.414e+01,2.397e+01,2.381e+01,2.366e+01,2.347e+01,2.331e+01,...
      2.326e+01,2.321e+01,2.306e+01,2.292e+01,2.276e+01,2.263e+01,...
      2.247e+01,2.235e+01,2.219e+01,2.204e+01,2.190e+01,2.176e+01,...
      2.160e+01,2.147e+01,2.131e+01,2.118e+01,2.103e+01,2.089e+01,...
      2.073e+01,2.060e+01,2.055e+01,2.053e+01,2.040e+01,2.028e+01,...
      2.014e+01,2.003e+01,1.990e+01,1.977e+01,1.965e+01,1.953e+01,...
      1.939e+01,1.927e+01,1.915e+01,1.902e+01,1.890e+01,1.878e+01,...
      1.864e+01,1.853e+01,1.840e+01,1.827e+01,1.825e+01,1.824e+01,...
      1.814e+01,1.803e+01,1.793e+01,1.783e+01,1.771e+01,1.762e+01,...
      1.750e+01,1.741e+01,1.729e+01,1.721e+01,1.708e+01,1.700e+01,...
      1.687e+01,1.679e+01,1.666e+01,1.657e+01,1.646e+01,1.636e+01,...
      1.633e+01,1.630e+01,1.622e+01,1.613e+01,1.604e+01,1.596e+01,...
      1.584e+01,1.578e+01,1.568e+01,1.559e+01,1.550e+01,1.540e+01,...
      1.532e+01,1.524e+01,1.513e+01,1.505e+01,1.496e+01,1.487e+01,...
      1.478e+01,1.469e+01,1.464e+01,1.463e+01,1.455e+01,1.445e+01,...
      1.438e+01,1.432e+01,1.421e+01,1.415e+01,1.405e+01,1.398e+01,...
      1.391e+01,1.382e+01,1.374e+01,1.367e+01,1.358e+01,1.350e+01,...
      1.343e+01,1.335e+01,1.325e+01,1.318e+01,1.316e+01,1.312e+01,...
      1.306e+01,1.300e+01,1.292e+01,1.285e+01,1.278e+01,1.270e+01,...
      1.265e+01,1.257e+01,1.250e+01,1.243e+01,1.236e+01,1.228e+01,...
      1.222e+01,1.215e+01,1.207e+01,1.201e+01,1.194e+01,1.186e+01,...
      1.185e+01,1.184e+01,1.178e+01,1.172e+01,1.166e+01,1.160e+01,...
      1.155e+01,1.147e+01,1.142e+01,1.136e+01,1.130e+01,1.124e+01,...
      1.118e+01,1.112e+01,1.106e+01,1.100e+01,1.094e+01,1.089e+01,...
      1.082e+01,1.075e+01,1.072e+01,1.070e+01,1.064e+01,1.059e+01,...
      1.052e+01,1.047e+01,1.042e+01,1.037e+01,1.031e+01,1.025e+01,...
      1.020e+01,1.015e+01,1.010e+01,1.003e+01,9.980e+00,9.920e+00,...
      9.860e+00,9.820e+00,9.750e+00,9.710e+00,9.700e+00,9.700e+00,...
      9.630e+00,9.590e+00,9.560e+00,9.500e+00,9.450e+00,9.410e+00,...
      9.360e+00,9.320e+00,9.270e+00,9.220e+00,9.180e+00,9.130e+00,...
      9.080e+00,9.050e+00,8.990e+00,8.940e+00,8.900e+00,8.850e+00,...
      8.810e+00];

w = 0.25 : 0.01 : 4.00;
w = 10000./w;
d = ttorad(w,5800) * 6.785087652174316e-5; 
[lambda,rout] = rads_wnum2lamda(w,d);

figure(1)
plot(lambda,rout,lsun,sun,wehrli(:,1),wehrli(:,2));  %%% units of W /m2/um/sr
xlabel('wavelength \lambda (um)'); ylabel('vis units of r');
title('ttorad(w,5800) vs SBDART vs WEHRLI')
axis([0 4 0 2500]); grid on
line([0.4 0.4],[0 2500],'Color',[0 0 1]);
line([0.7 0.7],[0 2500],'Color',[0 0 1]);
h = text(0.5,2000,'visible wavelengths'); set(h,'Color','blue');
line([3.0 3.0],[0 2500],'Color',[1 0 0]);
line([3.9 3.9],[0 2500],'Color',[1 0 0]);
h = text(3.0,1800,'SWIR wavelengths'); set(h,'Color','red');

figure(2)
[wx,rx] = rads_lamda2wnum(lsun,sun');
[ww,rw] = rads_lamda2wnum(wehrli(:,1),wehrli(:,2));
plot(w,d,wx,rx,ww,rw);  %%% in units of mW/m2/cm-1/sr
xlabel('waveumber cm-1'); ylabel('vis units of kcarta');
title('ttorad(w,5800) vs SBDART vs WEHRLI')
line([10000/0.4 10000/0.4],[0 80],'Color',[0 0 1]);
line([10000/0.7 10000/0.7],[0 80],'Color',[0 0 1]);
h = text(10000/0.5,50,'visible wavelengths'); set(h,'Color','blue');
line([10000/3.0 10000/3.0],[0 80],'Color',[1 0 0]);
line([10000/3.9 10000/3.9],[0 80],'Color',[1 0 0]);
h = text(10000/3.5,30,'SWIR wavelengths'); set(h,'Color','red');